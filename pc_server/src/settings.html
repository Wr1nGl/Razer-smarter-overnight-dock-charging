<!DOCTYPE html>
<html>
<head>
    <title>Server Settings</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #222; color: white; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 14px; }
        input { 
            width: 100%; 
            padding: 8px; 
            background: #333; 
            border: 1px solid #555; 
            color: white; 
            border-radius: 4px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h3>Device Configuration</h3>
    
    <div class="input-group">
        <label>Max battery level in %</label>
        <input type="number" id="battery_max_charge_level" placeholder="Default is 80" step="1" min="1" max="100">
    </div>
    
    <div class="input-group">
        <label>Charging time in minutes</label>
        <input type="number" id="charge_time" placeholder="Default is 5" step="1" min="1" max="100">
    </div>

    <div class="input-group">
        <label>Cooling time in minutes</label>
        <input type="number" id="cooldown_time" placeholder="Default is 10" step="1" min="1" max="100">
    </div>

    <div class="input-group">
        <label>% charge gain during charging time (battery in %)</label>
        <input type="number" id="charge_gain" placeholder="Default is 10" step="0.1" min="1" max="100">
    </div>

    <div class="input-group">
        <label>Server Port</label>
        <input type="number" id="port" placeholder="Default is 5000" step="1" min="1" max="65535">
    </div>

    <button id="saveBtn">Save Settings</button>

    <button id="calculate_charge" style="background: #28a745; margin-right: 10px;">Calculate charge change</button>

    <script>
        const api = window.electronAPI;
        const saveBtn = document.getElementById('saveBtn');
        const calcBtn = document.getElementById('calculate_charge');

        api.onLoadSettings((config) => {
            document.getElementById('battery_max_charge_level').value = config.battery_max_charge_level;
            document.getElementById('charge_time').value = config.charge_time;
            document.getElementById('cooldown_time').value = config.cooldown_time;
            document.getElementById('charge_gain').value = config.charge_gain;
            document.getElementById('port').value = config.port;
        });

        saveBtn.addEventListener('click', () => {
            const clamp = (val, min, max) => Math.max(min, Math.min(max, val));

            const data = {
                battery_max_charge_level: clamp(parseInt(document.getElementById('battery_max_charge_level').value), 1, 100),
                charge_time: clamp(parseInt(document.getElementById('charge_time').value), 1, 100),
                cooldown_time: clamp(parseInt(document.getElementById('cooldown_time').value), 1, 100),
                charge_gain: clamp(parseFloat(document.getElementById('charge_gain').value), 1, 100),
                port: clamp(parseInt(document.getElementById('port').value), 1, 65535)
            };

            const originalText = saveBtn.innerText;
            const originalBG = saveBtn.style.background;
            saveBtn.innerText = "Settings Saved!";
            saveBtn.style.background = "#28a745";
            saveBtn.disabled = true;

            api.saveSettings(data);

            setTimeout(() => {
                saveBtn.innerText = originalText;
                saveBtn.style.background = originalBG;
                saveBtn.disabled = false;
            }, 1000);
        });

        calcBtn.addEventListener('click', () => {
            calcBtn.disabled = true;
            calcBtn.style.backgroundColor = "#555";
            
            api.calculateCharge();
        });

        api.onTimerUpdate((timeLeft) => {
            if (timeLeft > 0) {
                calcBtn.innerText = `Wait: ${timeLeft} min...`;
            } else {
                calcBtn.disabled = false;
                calcBtn.innerText = "Calculate Charge Gain";
                calcBtn.style.backgroundColor = "#28a745";
            }
        });
        /*
        const { ipcRenderer } = require('electron');
        
        
        ipcRenderer.on('load-settings', (event, config) => {
            document.getElementById('battery_max_charge_level').value = config.battery_max_charge_level;
            document.getElementById('charge_time').value = config.charge_time;
            document.getElementById('cooldown_time').value = config.cooldown_time;
            document.getElementById('charge_gain').value = config.charge_gain;
            document.getElementById('port').value = config.port;
        });

        document.getElementById('saveBtn').addEventListener('click', () => {
            const clamp = (val, min, max) => Math.max(min, Math.min(max, val));

            const data = {
                battery_max_charge_level: clamp(parseInt(document.getElementById('battery_max_charge_level').value), 1, 100),
                charge_time: clamp(parseInt(document.getElementById('charge_time').value), 1, 100),
                cooldown_time: clamp(parseInt(document.getElementById('cooldown_time').value), 1, 100),
                charge_gain: clamp(parseInt(document.getElementById('charge_gain').value), 1, 100),
                port: clamp(parseInt(document.getElementById('port').value), 1, 65535)
            };

            document.getElementById('charge_time').value = data.charge_time;
            document.getElementById('cooldown_time').value = data.cooldown_time;
            document.getElementById('charge_gain').value = data.charge_gain;
            document.getElementById('battery_max_charge_level').value = data.battery_max_charge_level;
            document.getElementById('port').value = data.port;

            ipcRenderer.send('save-settings', data);

            const originalText = saveBtn.innerText;
            const originalBG = saveBtn.style.background;

            saveBtn.innerText = "Settings Saved!";
            saveBtn.style.background = "#28a745";
            saveBtn.disabled = true;

            setTimeout(() => {
                saveBtn.innerText = originalText;
                saveBtn.style.background = originalBG;
                saveBtn.disabled = false;
            }, 1000);
        });

        const calcBtn = document.getElementById('calculate_charge');

        calcBtn.addEventListener('click', () => {
            calcBtn.disabled = true;
            calcBtn.style.backgroundColor = "#555";
            
            ipcRenderer.send('calculate_charge');
        });

        ipcRenderer.on('timer-update', (event, timeLeft) => {
            if (timeLeft > 0) {
                calcBtn.innerText = `Wait: ${timeLeft} min...`;
            } else {
                calcBtn.disabled = false;
                calcBtn.innerText = "Calculate Charge Gain";
                calcBtn.style.backgroundColor = "#28a745"; // Reset to original color
            }
        });
        */
    </script>
</body>
</html>